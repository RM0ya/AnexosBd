

CREATE TABLE SEDE (
  id_sede NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  nombre_sede VARCHAR2(50) NOT NULL UNIQUE,
  comuna VARCHAR2(50) NOT NULL,
  region VARCHAR2(50) DEFAULT 'RegiÃ³n Metropolitana'
);


CREATE TABLE CARRERA (
    id_carrera NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre_carrera VARCHAR(100) NOT NULL UNIQUE,
    duracion_semestres INT CHECK (duracion_semestres BETWEEN 4 AND 12),
    id_sede INT NOT NULL,
    FOREIGN KEY (id_sede) REFERENCES SEDE(id_sede)
);

CREATE TABLE ESTUDIANTE (
  id_estudiante NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  rut VARCHAR2(12) NOT NULL UNIQUE,
  nombres VARCHAR2(100) NOT NULL,
  apellidos VARCHAR2(100) NOT NULL,
  fecha_nacimiento DATE,
  direccion VARCHAR2(150),
  correo_institucional VARCHAR2(100) UNIQUE,
  telefono VARCHAR2(15)
);

CREATE TABLE DOCENTE (
    id_docente NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    rut VARCHAR(12) NOT NULL UNIQUE,
    nombres VARCHAR(100) NOT NULL,
    apellidos VARCHAR(100) NOT NULL,
    titulo_profesional VARCHAR(100),
    correo_institucional VARCHAR(100) UNIQUE,
    telefono VARCHAR(15)
);

CREATE TABLE CONTRATO_DOCENTE (
    id_contrato NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_docente INT NOT NULL,
    fecha_inicio DATE NOT NULL,
    fecha_fin DATE,
    tipo_contrato VARCHAR(50) CHECK (tipo_contrato IN ('Plazo Fijo', 'Indefinido', 'Honorarios')),
    sueldo_mensual DECIMAL(10,2) CHECK (sueldo_mensual > 0),
    FOREIGN KEY (id_docente) REFERENCES DOCENTE(id_docente)
);

CREATE TABLE ASIGNATURA (
    id_asignatura NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre_asignatura VARCHAR(100) NOT NULL,
    semestre INT CHECK (semestre BETWEEN 1 AND 12),
    id_carrera INT NOT NULL,
    id_docente INT,
    FOREIGN KEY (id_carrera) REFERENCES CARRERA(id_carrera),
    FOREIGN KEY (id_docente) REFERENCES DOCENTE(id_docente)
);

CREATE TABLE MATRICULA (
    id_matricula NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_estudiante INT NOT NULL,
    id_carrera INT NOT NULL,
    anio YEAR NOT NULL,
    semestre INT CHECK (semestre IN (1,2)),
    fecha_matricula DATE DEFAULT CURRENT_DATE,
    estado VARCHAR(20) DEFAULT 'Activa' CHECK (estado IN ('Activa','Retirada','Egresada')),
    FOREIGN KEY (id_estudiante) REFERENCES ESTUDIANTE(id_estudiante),
    FOREIGN KEY (id_carrera) REFERENCES CARRERA(id_carrera)
);

CREATE TABLE ASISTENCIA (
    id_asistencia NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_estudiante INT NOT NULL,
    id_asignatura INT NOT NULL,
    fecha DATE NOT NULL,
    presente BOOLEAN NOT NULL,
    FOREIGN KEY (id_estudiante) REFERENCES ESTUDIANTE(id_estudiante),
    FOREIGN KEY (id_asignatura) REFERENCES ASIGNATURA(id_asignatura)
);
ALTER TABLE ASISTENCIA MODIFY (presente VARCHAR2(2) CHECK (presente IN ('S','N')));


CREATE TABLE NOTA (
    id_nota NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_estudiante INT NOT NULL,
    id_asignatura INT NOT NULL,
    evaluacion VARCHAR(100) NOT NULL,
    calificacion DECIMAL(3,1) CHECK (calificacion BETWEEN 1.0 AND 7.0),
    FOREIGN KEY (id_estudiante) REFERENCES ESTUDIANTE(id_estudiante),
    FOREIGN KEY (id_asignatura) REFERENCES ASIGNATURA(id_asignatura)
);

CREATE TABLE BECA (
    id_beca NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    nombre_beca VARCHAR(100) NOT NULL UNIQUE,
    porcentaje_descuento INT CHECK (porcentaje_descuento BETWEEN 0 AND 100)
);

CREATE TABLE BECA_ASIGNADA (
    id_beca_asignada NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_estudiante INT NOT NULL,
    id_beca INT NOT NULL,
    anio YEAR NOT NULL,
    FOREIGN KEY (id_estudiante) REFERENCES ESTUDIANTE(id_estudiante),
    FOREIGN KEY (id_beca) REFERENCES BECA(id_beca)
);

CREATE TABLE PAGO (
    id_pago NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    id_matricula INT NOT NULL,
    monto DECIMAL(10,2) NOT NULL CHECK (monto >= 0),
    fecha_pago DATE NOT NULL,
    metodo_pago VARCHAR(50) CHECK (metodo_pago IN ('Efectivo','Transferencia','Tarjeta')),
    FOREIGN KEY (id_matricula) REFERENCES MATRICULA(id_matricula)
);
